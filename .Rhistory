ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi-r_me"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
View(dens_plots)
##soi-r_me
dens_plots[["soi_r_me"]]<-ggplot(data, aes(x=soi_r_me)) +
geom_histogram(aes(y=..density..), colour="black", fill="white")+
geom_density(alpha=.2, fill="#FF6666")
ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
names(data)
densplots[["dens_grid"]]<-ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["social_anxiety"]],
dens_plots[["lon"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
dens_plots[["dens_grid"]]<-ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["social_anxiety"]],
dens_plots[["lon"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
dens_plots[["dens_grid"]]
ggpubr::ggarrange(dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["social_anxiety"]],
dens_plots[["lon"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=4,
nrow=2
)
dens_plots[["dens_grid"]]<-ggpubr::ggarrange(
dens_plots[["sex_drive"]],
dens_plots[["csbd"]],
dens_plots[["ppcs"]],
dens_plots[["soi_r_me"]],
dens_plots[["mvs"]],
dens_plots[["social_anxiety"]],
dens_plots[["lon"]],
dens_plots[["mvs"]],
dens_plots[["attraction_to_children"]],
ncol=5,
nrow=2
)
dens_plots[["dens_grid"]]
choose_BIC <- mclustBIC(data %>% select(-uid), prior = priorControl())
choose_BIC
3:7
lpa <- Mclust(data %>% select(-uid), prior=priorControl(), G=3:7, modelNames=c("VVV"))
View(lpa)
lpa
lpa_models <- list()
as.character(1)
lpa_models <- list()
for (i in 3:7){
lpa_models[[as.character(i)]] <- Mclust(data %>% select(-uid), prior=priorControl(), G=i, modelNames=c("VVV"))
}
plot(choose_BIC)
summary(lpa_models[["3"]])
summary(lpa_models[["3"]], parameters=TRUE)
scipen=F
scipen=0
options(scipen=0)
summary(lpa_models[["3"]], parameters=TRUE)
lpa_models[["3"]]$uncertainty
plot(lpa_models[["3"]], what="uncertainty")
quantile(lpa_models[["3"]]$uncertainty)
options(scipen = 999)
quantile(lpa_models[["3"]]$uncertainty)
3.3619e-01
1.3921e-03
lpa_models[["7"]]
summary(lpa_models[["7"]])
summary(lpa_models[["7"]], parameters = TRUE)
summary(lpa_models[["4"]])
summary(lpa_models[["4"]], parameters=TRUE)
quantiles(lpa_models[["4"]]$uncertainty)
quantile(lpa_models[["4"]]$uncertainty)
knitr::opts_chunk$set(echo = TRUE)
#Declare vector of required packages
packages <- c("tidyverse", "readr", "mclust")
#load function to check whether required packages are installed.
source("./functions/check_required_packages.R")
check_required_packages(packages)
#load required packages
lapply(packages, require, character.only=T)
??createMulitfFolds
install.packages("caret")
View(data)
folds <- createMuliFolds(data %>% select(-uid), k=5, times=10)
folds <- caret::createMultiFolds(data %>% select(-uid), k=5, times=10)
View(folds)
View(data)
folds[[1]]
View(data)
folds <- caret::createMultiFolds(data %>% pull(uid), k=5, times=10)
View(data)
folds[[1]]
View(lpa_models)
knitr::opts_chunk$set(echo = TRUE)
source("./functions/Cosine Similarity.R")
#Computes the dunn index with cosine similarity instead of euclidean distances.
lpa_models <- lpa_models %>% mutate(cv_dunn_cos = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the Dunn index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid) %>% cos_dissim
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::dunn(distance=distance, clusters=clusters))
}) %>% unlist())
set.seed(42)
#Declare vector of required packages
packages <- c("tidyverse", "readr", "mclust")
#load function to check whether required packages are installed.
source("./functions/check_required_packages.R")
check_required_packages(packages)
#load required packages
lapply(packages, require, character.only=T)
source("./functions/Cosine Similarity.R")
#Computes the dunn index with cosine similarity instead of euclidean distances.
lpa_models <- lpa_models %>% mutate(cv_dunn_cos = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the Dunn index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid) %>% cos_dissim
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::dunn(distance=distance, clusters=clusters))
}) %>% unlist())
#Computes the dunn index with cosine similarity instead of euclidean distances.
lpa_models <- lpa_models %>% mutate(cv_dunn_cos = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the Dunn index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid) %>% cos_dissim
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::dunn(distance=distance, clusters=clusters))
}) %>% unlist())
#Computes the dunn index based on euclidean distances
lpa_models <- lpa_models %>% mutate(cv_dunn = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the Dunn index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid)
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::dunn(Data=distance, clusters=clusters, method = "euclidean"))
}) %>% unlist())
#creating connectivity index based on cosine dissimilarity
lpa_models <- lpa_models %>% mutate(cv_conn_cos = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the connectivity index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid) %>% cos_dissim
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::connectivity(distance=distance, clusters=clusters))
}) %>% unlist())
#creating Connectivity index for euclidean distances
lpa_models <- lpa_models %>% mutate(cv_conn = lapply(1:nrow(lpa_models),function(x){
#Get a distance measure to base the Dunn index on. Cosine is nice, because the scale differences are less important as with euclidean distances.
distance <- data[data$uid %in% (lpa_models[x,c("test_fold_uids")] %>% unlist()),] %>% select(-uid)
#Get predicted cluster memberships
clusters <- (lpa_models[x,] %>% pull(cv_predicted_clusters) %>% unlist())
#feed both in the dunn function from the clValid package
return(clValid::connectivity(Data=distance, clusters=clusters, method = "euclidean"))
}) %>% unlist())
lpa_model_eval <- lpa_models %>% group_by(nclust) %>% summarize(conn_cos = mean(cv_conn_cos), conn = mean(cv_conn), dunn = mean(cv_dunn), dunn_cos = mean(cv_dunn_cos), sil=mean(cv_silhouette))
View(lpa_models)
View(lpa_model_eval)
results <- lpa_models %>% select(nclust, fold, rep, test_fold_uids, cv_predicted_clusters)
results <- results %>% select(-test_fold_uids, -cv_predicted_clusters) %>% unite("dat_name", nclust:fold:rep, sep="_")
View(results)
results <- lpa_models %>% select(nclust, fold, rep, test_fold_uids, cv_predicted_clusters)
results <- results %>% select(-test_fold_uids, -cv_predicted_clusters) %>% unite("dat_name", nclust:fold:rep, sep="_,", remove=FALSE) %>% select(-nclust, -fold,-rep)
View(results)
results <- lpa_models %>% select(nclust, fold, rep, test_fold_uids, cv_predicted_clusters)
results <- results %>% select(-test_fold_uids, -cv_predicted_clusters) %>% unite("dat_name", nclust:fold:rep, sep="_,", remove=FALSE) %>% select(-nclust, -fold,-rep)
View(results)
results <- lpa_models %>% select(nclust, fold, rep, test_fold_uids, cv_predicted_clusters)
results <- results  %>% unite("dat_name", nclust:fold:rep, sep="_,", remove=FALSE) %>% select(-nclust, -fold,-rep)
View(results)
results <- lpa_models %>% select(nclust, fold, rep, test_fold_uids, cv_predicted_clusters)
results <- results  %>% unite("dat_name", nclust:fold:rep, sep="_", remove=FALSE) %>% select(-nclust, -fold,-rep)
results[1,c("dat_name")]
results[1,c("dat_name")] %>% str()
results[1,c("dat_name")] %>% class()
paste("./data/data_prepared/",results[1,c("dat_name")],".csv")
paste("./data/data_prepared/",results[1,c("dat_name")],".csv", sep="")
for (i in 1:nrow(results)){
t <- tibble(uids = results[i,] %>% pull(test_fold_uids) %>% unlist(), cluster = results[i,] %>% pull(cv_predicted_clusters) %>% unlist())
name <- paste("./data/data_prepared/",results[i,c("dat_name")],".csv", sep="")
readr::write_csv(data=t, file=name)
}
for (i in 1:nrow(results)){
t <- tibble(uids = results[i,] %>% pull(test_fold_uids) %>% unlist(), cluster = results[i,] %>% pull(cv_predicted_clusters) %>% unlist())
name <- paste("./data/data_prepared/",results[i,c("dat_name")],".csv", sep="")
readr::write_csv(x=t, file=name)
}
save.image("C:/Users/gniel/OneDrive - MSB Medical School Berlin/Project special issue/LPA_analysis/.RData")
View(lpa_models)
knitr::opts_chunk$set(echo = TRUE)
#Declare vector of required packages
packages <- c("tidyverse", "readr", "dbscan")
set.seed(42)
#load function to check whether required packages are installed.
source("./functions/check_required_packages.R")
check_required_packages(packages)
check_required_packages(packages)
#load required packages
lapply(packages, require, character.only=T)
View(data)
dbscan::optics(x=data %>% select(-uid), minPts = 16)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% plot()
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.5)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.1)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.2)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.3)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.09)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.1)
dbscan::optics(x=data %>% select(-uid), minPts = 16) %>% extractXi(xi=0.05)
xi <- c(0.05, 0.04, 0.03, 0.02, 0.01,0.001)
View(lpa_models)
folds <- lpa_models %>% select(nclust, fold, rep, folds,test_fold_uids)
View(folds)
min_Pts = 5:20
?seq()
min_Pts = seq(5,20,by=5)
min_Pts
View(folds)
fodls %>% pull(fodls)
fodls %>% pull(folds)
folds %>% pull(folds)
folds %>% pull(folds) %>% class()
?optics
min_Pts = seq(5,20,by=5)
optics_models <- list()
folds <- lpa_models %>% select(nclust, fold, rep, folds,test_fold_uids)
for (p in min_Pts){
optics_models[[as.character(p)]] <- lapply(folds %>% pull(folds), function(x) {dbscan::optics(x = data[x,] %>% select(-uid), eps=NULL,minPts = p)})
}
View(optics_models)
optics_models <- tibble(names = optics_models_models %>% list_flatten() %>% names(), models = optics_models %>% list_flatten())
optics_models <- tibble(names = optics_models %>% list_flatten() %>% names(), models = optics_models %>% list_flatten())
optics_models[1,2]
optics_models$models[1]
names <- optics_models %>% pull(names) %>% str_split_fixed("_", 2) %>% as_tibble() %>% rename(minPts=V1, fold=V2)
names <- names %>% select(-fold) %>% cbind( names %>% pull(fold) %>% str_split_fixed("\\.", 2) %>% as_tibble() %>% rename(fold = V1, rep = V2))
View(names)
optics_models <- cbind(names, optics_models)
optics_models <- optics_models %>% select(-names)
View(optics_models)
View(optics_models)
optics_models[1,] %>% pull(models) %>% extractDBSCAN(, Inf)
optics_models[1,] %>% pull(models) %>% extractDBSCAN(, eps_cl = Inf)
optics_models[1,] %>% pull(models) %>% extractDBSCAN()
optics_models[1,] %>% pull(models) %>% unlist() %>% extractDBSCAN()
optics_models[1,] %>% pull(models) %>% class()
optics_models[1,] %>% pull(models) %>% class() %>% ulist()
optics_models[1,] %>% pull(models) %>% class() %>% unlist()
optics_models$models[1]
optics_models$models[1] %>% extractDBSCAN()
optics_models$models[1][] %>% extractDBSCAN()
optics_models$models[1][1]
optics_models$models[1][1] %>% class()
optics_models$models[1][1] %>% str()
optics_models$models[1] %>% unlist()
View(optics_models)
optics_models %>% pull(models)[1]
optics_models %>% pull(models)
optics_models$models$5_Fold1.Rep01 %>% class()
optics_models$models$5_Fold1.Rep01
optics_models$models$"5_Fold1.Rep01"
optics_models$models$"5_Fold1.Rep01" %>% class8
optics_models$models$"5_Fold1.Rep01" %>% class()
optics_models$models$"5_Fold1.Rep01" %>% extractDBSCAN()
optics_models$models$"5_Fold1.Rep01" %>% extractDBSCAN(eps_cl= 27)
optics_models$models$"5_Fold1.Rep01" %>% extractDBSCAN(eps_cl= 5)
optics_models$models$"5_Fold1.Rep01" %>% extractDBSCAN(eps_cl = 27)
optics_models$models$"5_Fold1.Rep01" %>% extractXi(xi = 0.05)
optics_models$models$"5_Fold1.Rep01" %>% extractXi(xi = 0.005)
optics_models$models$"5_Fold1.Rep01" %>% extractXi(xi = 0.03)
optics(data %>% select(-uid), minPts = 5)
optics(data %>% select(-uid), minPts = 5) %>% extractXi(Xi=0.05)
optics(data %>% select(-uid), minPts = 5) %>% extractXi(0.05)
optics(data %>% select(-uid), minPts = 5) %>% extractXi(0.03)
optics(data %>% select(-uid), minPts = 5) %>% extractXi(0.01)
optics(data %>% select(-uid), minPts = 10) %>% extractXi(0.05)
optics(data %>% select(-uid), minPts = 15) %>% extractXi(0.05)
optics(data %>% select(-uid), minPts = 20) %>% extractXi(0.05)
optics(data %>% select(-uid), minPts = 20) %>% extractXi(0.05)$cluster
optics(data %>% select(-uid), minPts = 20) %>% extractXi(0.05)
#It#s very hard to find any recommendations on the value of xi. It tells the clustering algorithm what change in density a beginning and the end of a cluster marks. Therefore we refer to the values that are referenced in the
xi <- c(0.001, 0.005, 0.01, 0.05, 0.1)
predict.dbscan
?list()
View(folds)
View(folds)
folds <- lpa_models %>% select(nclust, fold, rep, folds,test_fold_uids) %>% filter(nclust=3)
folds <- lpa_models %>% select(nclust, fold, rep, folds,test_fold_uids) %>% filter(nclust==3)
View(folds)
for (p in min_Pts){
optics_models[[as.character(p)]] <- lapply(folds %>% pull(folds), function(x) {dbscan::optics(x = data[x,] %>% select(-uid), eps=NULL,minPts = p)})
}
optics_models <- tibble(names = optics_models %>% list_flatten() %>% names(), models = optics_models %>% list_flatten())
View(optics_models)
rm(optics_models)
optics_models <- list()
min_Pts
View(folds)
View(folds)
folds$folds[1]
folds$folds[1] %>% class()
folds$folds[1] %>% as.vector()
folds$folds[1] %>% as.vector() %>% class()
folds$folds[1] %>% as.numeric()
folds$folds[1] %>% unlist()
folds$folds[1] %>% unlist() %>% class()
min_Pts = seq(5,20,by=5)
optics_models <- list()
folds <- lpa_models %>% select(nclust, fold, rep, folds,test_fold_uids) %>% filter(nclust==3)
for (p in min_Pts){
optics_models[[as.character(p)]] <- lapply(folds %>% pull(folds), function(x) {dbscan::optics(x = data[x %>% unlist(),] %>% select(-uid), eps=NULL,minPts = p)})
}
View(optics_models)
optics_models <- tibble(names = optics_models %>% list_flatten() %>% names(), models = optics_models %>% list_flatten())
View(optics_models)
names <- optics_models %>% pull(names) %>% str_split_fixed("_", 2) %>% as_tibble() %>% rename(minPts=V1, fold=V2)
names <- names %>% select(-fold) %>% cbind( names %>% pull(fold) %>% str_split_fixed("\\.", 2) %>% as_tibble() %>% rename(fold = V1, rep = V2))
optics_models <- cbind(names, optics_models)
optics_models <- optics_models %>% select(-names)
View(folds)
optics_models %>% mutate(folds=replicate(5, folds %>% pull(folds), simplify = FALSE) %>% list_flatten())
optics_models %>% mutate(folds=replicate(5, folds %>% pull(folds), simplify = FALSE))
optics_models %>% mutate(folds=replicate(4, folds %>% pull(folds), simplify = FALSE))
replicate(4, folds %>% pull(folds), simplify = FALSE)
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% str()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% length()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten() %>% length()
optics_models %>% mutate(folds=replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten())
optics_models %>% mutate(folds=replicate(4, folds %>% pull(folds), simplify = FALSE)) %>% length()
optics_models %>% mutate(folds=replicate(4, folds %>% pull(folds), simplify = FALSE) %>% unlist()) %>% length()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% unlist())
View(folds)
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% unlist() %>% length()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% length()
replicate(4, folds %>% select(folds), simplify = FALSE) %>% length()
replicate(4, folds %>% select(folds), simplify = FALSE) %>% unlist() %>% length()
replicate(4, folds %>% select(folds), simplify = FALSE) %>% list_flatten() %>% length()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten() %>% length()
View(optics_models)
optics_models <-  optics_models %>%  mutate(folds = replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten())
optics
?optics
optics_models$models[1] %>% class()
optics_models$models[1] %>% unlist() %>% class()
optics_models$models[1] %>% list_flatten() %>% class()
optics_models$models[1] %>% list_flatten()
optics_models$models[1] %>% list_flatten() %>% list_flatten() %>% class()
optics_models$models[1] %>% list_flatten() %>% list_flatten()
optics_models[1,] %>% pull(models)
optics_models[1,] %>% pull(models) %>% flatten_list()
optics_models[1,] %>% pull(models) %>% l_flattenist()
optics_models[1,] %>% pull(models) %>% list_flatten()
optics_models$models[[1]]
test <- lapply(1:200, function(x){extractXi(optics_models$models[[x]], 0.001)})
View(test)
test[[1]]$cluster
test[[1]]$cluster %>% view()
test[[1]]$clusters_xi
test[[1]]$clusters_xi %>% view()
test[[1]]$clusters_xi
test[[1]]
test[[1]]$order
test[[1]]$cluster %>% view()
test[[1]]$cluster %>% table()
View(test)
paste("0.004", "Xi", sep="_")
for (x in xi){
optics_models[paste(x, "Xi", sep="_")] <- lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], 0.001)$cluster})
}
View(optics_models)
optics_models<- optics_models[,-6:10]
optics_models<- optics_models[,-c(6:10)]
test <- lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], 0.001)$cluster})
View(t)
View(test)
optics_models %>% class()
for (x in xi){
optics_models[paste(x, "Xi", sep="_")] <- lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], x)$cluster})
}
optics_modela <- optics_models %>% as_tibble()
optics_models <- optics_models %>% as_tibble()
rm(optics_modela)
optics_models %>% class()
for (p in xi){
optics_models[paste(p, "Xi", sep="_")] <- lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], p)$cluster})
}
View(optics_models)
lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], 0.05)$cluster}) %>% length()
lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], 0.05)$cluster}) %>% class()
for (p in xi){
optics_models<- add_column(paste(p, "Xi", sep="_") = lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], p)$cluster}))
ncol(optics_models)
colnames(optics_models)
colnames(optics_models)[5]
optics_models_safe <- optics_models
for (p in xi){
optics_models <- cbind(optics_models, lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], p)$cluster}))
colnames(optics_models)[ncol(optics_mmodels)] <- paste(p, "Xi", sep="_")
}
for (p in xi){
optics_models <- cbind(optics_models, lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], p)$cluster}) %>% as_tibble_col())
colnames(optics_models)[ncol(optics_mmodels)] <- paste(p, "Xi", sep="_")
}
for (p in xi){
optics_models <- cbind(optics_models, lapply(1:nrow(optics_models), function(x){extractXi(optics_models$models[[x]], p)$cluster}) %>% as_tibble_col())
colnames(optics_models)[ncol(optics_models)] <- paste(p, "Xi", sep="_")
}
View(optics_models)
optics_models$models[[1]]$eps
View(folds)
optics_models <-  optics_models %>%  mutate(folds = replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten(), test_fold_uids = replicate(4, folds %>% pull(test_fold_uids), simplify = FALSE) %>% list_flatten())
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten()
replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten() %>% length()
replicate(4, folds %>% pull(test_fold_uids), simplify = FALSE) %>% list_flatten() %>% length()
optics_models <-  optics_models %>%  mutate(folds = replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten(), test_fold_uids = replicate(4, folds %>% pull(test_fold_uids), simplify = FALSE) %>% list_flatten())
#We add the folds to the tibble so we have everything nice and tidy and in one place.
train_folds <- replicate(4, folds %>% pull(folds), simplify = FALSE) %>% list_flatten()
test_folds <- replicate(4, folds %>% pull(test_fold_uids), simplify = FALSE) %>% list_flatten()
View(test_folds)
optics_models <-  optics_models %>%  mutate(folds = train_folds, test_fold_uids = test_folds)
View(optics_models)
data$uid %in% (optics_models[1,] %>% pull(test_fold_uids))
data$uid %in% (optics_models[1,] %>% pull(test_fold_uids)) %>% table()
View(optics_models)
optics_models[1,] %>% pull(test_fold_uids) %>% class()
optics_models[1,] %>% pull(test_fold_uids) %>% unlist() %>% class()
optics_models[1,] %>% pull(test_fold_uids) %>% unlist() %>% head()
data$uid %in% (optics_models[1,] %>% pull(test_fold_uids) %>% unlist()) %>% table()
data[data$uid %in% (optics_models[1,] %>% pull(test_fold_uids) %>% unlist())]
data[data$uid %in% (optics_models[1,] %>% pull(test_fold_uids) %>% unlist()),]
data[data$uid %in% (optics_models[1,] %>% pull(test_fold_uids) %>% unlist()),] %>% select(-uid)
extractDBSCAN(x=data[data$uid %in% (optics_models[1,] %>%
pull(test_fold_uids) %>%
unlist()),] %>% select(-uid),
eps = optics_models$models[[1]]$eps)}
extractDBSCAN(x=data[data$uid %in% (optics_models[1,] %>%
pull(test_fold_uids) %>%
unlist()),] %>% select(-uid),
eps = optics_models$models[[1]]$eps)
predict(newdata=data[data$uid %in% (optics_models[1,] %>%
pull(test_fold_uids) %>%
unlist()),] %>% select(-uid),
object =  = optics_models$models[[1]]$eps)
predict(newdata=data[data$uid %in% (optics_models[1,] %>%
pull(test_fold_uids) %>%
unlist()),] %>% select(-uid),
object =optics_models$models[[1]])
predict(newdata=data[data$uid %in% (optics_models[1,] %>%
pull(test_fold_uids) %>%
unlist()),] %>% select(-uid),
object =optics_models$models[[1]] %>% extractDBSCAN(eps_cl = optics_models$models[[1]]$eps))
View(lpa_models)
lpa_models$folds[[1]]
lpa_models$folds[[1]] %>% length()
data[optics_models$folds[[1]],] %>% select(-uid)Mhead()
data[optics_models$folds[[1]],] %>% select(-uid) %>% head()
predict(newdata=data[data$uid %in% (optics_models[1,] %>% pull(test_fold_uids) %>%unlist()),] %>% select(-uid),
object =optics_models$models[[1]] %>% extractDBSCAN(eps_cl = optics_models$models[[1]]$eps),
data = data[optics_models$folds[[1]],] %>% select(-uid)
)
View(lpa_models)
optics_models <- optics_models %>% mutate(cv_predicted_clusters = lapply(1:nrow(optics_models), function(i){predict(newdata=data[data$uid %in% (optics_models[i,] %>% pull(test_fold_uids) %>%unlist()),] %>% select(-uid),
object =optics_models$models[[i]] %>% extractDBSCAN(eps_cl = optics_models$models[[i]]$eps),
data = data[optics_models$folds[[i]],] %>% select(-uid))}))
